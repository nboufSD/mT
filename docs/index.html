<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://miro.com/app/static/sdk.1.1.js"></script>
    <canvas width="300" height="150" id="sample" style="background-color:yellow;"></canvas>
    <script>
    let allStickers;

    miro.onReady(() => {
      miro.addListener('WIDGETS_CREATED', widget => {
          console.log(widget)
        })
      miro.initialize({
        extensionPoints: {
          bottomBar: {
            title: 'Some title',
            svgIcon: '<circle cx="12" cy="12" r="9" fill="none" fill-rule="evenodd" stroke="currentColor" stroke-width="2"/>',
            onClick: () => {
              console.log(miro.board.info.get());
              miro.board.info.get().then((id) =>{
                console.log('boardId', id);
              })
              fetch("https://nboufsd.github.io/mT/json/sample.json")
                .then((response) => {
                    return response.json();　//ここでBodyからJSONを返す
                })
                .then((result) => {
                    Example(result);  //取得したJSONデータを関数に渡す
                })
                .catch((e) => {
                    console.log(e);  //エラーをキャッチし表示
                })
            }
          }
        }
      })
    })

    function Example(response){
      const users = response["userInfo"];

      users.sort(function(a, b) {
        return a.timeStamp - b.timeStamp;
      });
      console.log(users);

      const usersIds = users.map(function(user) {
        return user.userId;
      });

      const kindOfusers = users.filter(function(user, index) {
        return usersIds.indexOf(user.userId) === index;
      });

      for (let i = 0; i < kindOfusers.length; i++) {
        miro.board.widgets.create({
          type: 'text',
          text: kindOfusers[i]["userName"],
          x: 0,
          y: 0 + 150 * i,
        })
        miro.board.widgets.create({
          type: "image",
          url: kindOfusers[i]["userPhoto"],
          x: 100,
          y: 0 + 150 * i
        })
      }

      let tempUsers;
      const initUnixtime = 1616321772;
      const maxTimestamp = Math.max.apply(null,users.map(x => x.timeStamp));
      const intervalTime = ( maxTimestamp - initUnixtime ) / 30;
      console.log(maxTimestamp);
      console.log(intervalTime);

      let dateTime;
      let unixtime;
      for (let i = 0; i < 30; i++) {
        // unixtime = initUnixtime + Math.floor(intervalTime * i);
        unixtime = initUnixtime + Math.floor(60 * i);
        dateTime = new Date(unixtime * 1000);
        miro.board.widgets.create({
          type: 'text',
          width: 100,
          x: 210 + 50 + 60 * i,
          y: (( i + 2 ) % 2) === 0 ? -150 : -100,
          style: {
            // allowed values: "center", "right", "left"
            TextAlign: "r", // default: "center"
          },
          text: dateTime.toLocaleTimeString() + '',
          // x: 210 + 50 + intervalTime * i,
        })
      }

      for (let i = 0; i < kindOfusers.length; i++) {
        tempUsers = users.filter(user =>
          user.userId === kindOfusers[i].userId
        );
        for (let j = 0; j < tempUsers.length; j++) {
          miro.board.widgets.create({
            type: "image",
            url: tempUsers[j]["imageUrl"],
            x: 210 + 50 + Number(tempUsers[j]["timeStamp"] - initUnixtime) ,
            y: 0 + 150 * i,
          })
          console.log(new Date(tempUsers[j]["timeStamp"] * 1000));
          miro.board.widgets.create({
            type: 'sticker',
            text: tempUsers[j]["message"],
            x: 210 + 50 + Number(tempUsers[j]["timeStamp"] - initUnixtime),
            y: 70 + 150 * i,
            scale: 0.2,
            style: {
              stickerBackgroundColor: tempUsers[j]["messageColor"],
            }
          })
        }
      }
    }
    </script>
</head>
<body>
  <img src = "images/1.png">
  <img src = "images/2.png">
  <img src = "images/3.png">
  <img src = "images/4.png">
  <img src = "images/5.png">
  <img src = "images/6.png">
  <img src = "images/7.png">
  <img src = "images/8.png">
  <img src = "images/9.png">
  <img src = "images/A.png">
  <img src = "images/B.png">
  <img src = "images/C.png">
  HELLO WORLD
</body>
</html>
